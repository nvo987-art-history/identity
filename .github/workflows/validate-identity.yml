name: Identity Full Root Validator

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
      # -------------------------
      # FULL CHECKOUT
      # -------------------------
      - name: Checkout FULL repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # -------------------------
      # DEBUG â€“ SHOW FULL TREE
      # -------------------------
      - name: Show full repository tree
        run: |
          echo "Workspace: $GITHUB_WORKSPACE"
          echo "Total files:"
          find "$GITHUB_WORKSPACE" -type f | wc -l
          echo "---- FULL TREE ----"
          ls -R "$GITHUB_WORKSPACE"

      # -------------------------
      # INSTALL TOOLS
      # -------------------------
      - name: Install tools
        run: |
          sudo apt-get update
          sudo apt-get install -y jq

      # -------------------------
      # VALIDATE ALL JSON + JSONLD (FULL ROOT)
      # -------------------------
      - name: Validate ALL JSON / JSONLD
        run: |
          set -e
          find "$GITHUB_WORKSPACE" -type f \( -name "*.json" -o -name "*.jsonld" \) ! -path "*/.git/*" -print0 \
          | while IFS= read -r -d '' file; do
              echo "Checking $file"
              jq empty "$file"
            done
          echo "JSON validation complete."

      # -------------------------
      # VALIDATE ALL HTML (FULL ROOT)
      # -------------------------
      - name: Validate ALL HTML
        run: |
          set -e
          find "$GITHUB_WORKSPACE" -type f -name "*.html" ! -path "*/.git/*" -print0 \
          | while IFS= read -r -d '' file; do
              echo "Checking $file"
              grep -q "<html" "$file"
              grep -q "</html>" "$file"
            done
          echo "HTML validation complete."

      # -------------------------
      # CHECK EMPTY FILES (FULL ROOT)
      # -------------------------
      - name: Fail if any empty file exists
        run: |
          set -e
          find "$GITHUB_WORKSPACE" -type f ! -path "*/.git/*" -print0 \
          | while IFS= read -r -d '' file; do
              if [ ! -s "$file" ]; then
                echo "Empty file detected: $file"
                exit 1
              fi
            done
          echo "No empty files detected."

      - name: Final status
        run: echo "FULL ROOT VALIDATION PASSED"
